# Once again, thanks to a stackoverflow user for this hack
# Source: https://stackoverflow.com/a/24600210
# Handle git submodules yourself
git:
    submodules: false
# Use sed to replace the SSH URL with the public URL, then initialize submodules
before_install:
    - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
    - git submodule update --init --recursive

install:
  - wget https://github.com/devkitPro/pacman/releases/download/devkitpro-pacman-1.0.1/devkitpro-pacman.deb
  - sudo dpkg -i devkitpro-pacman.deb
  - sudo /opt/devkitpro/pacman/bin/pacman --noconfirm -Syu
  - sudo /opt/devkitpro/pacman/bin/pacman --noconfirm -S switch-dev switch-libvorbisidec switch-libmikmod switch-flac switch-libogg
  - source /etc/profile.d/devkit-env.sh
  - export DEVKITA64=$DEVKITPRO/devkitA64
  - git clone https://github.com/aagallag/SDL-SWITCH.git -b master-aagallag
  - cd SDL-SWITCH/
  - make SDL
  - cd SDL-1.2.15/
  - sudo make install
  - cd ../
  - make SDL_mixer
  - cd SDL_mixer-1.2.12/
  - sudo make install
  - cd ../../

script:
  - make
  - cd d1/
  - make dist-bin
  - cd ../d2/
  - make dist-bin
  - cd ../
